(function(n){n.fn.serializeObject=function(){"use strict";var i=this.serializeArray(),t;return n(".aceui-checkbox:not(:checked)").filter(function(){return this.name&&!this.disabled}).map(function(){return{name:this.name,value:0}}).each(function(){i.push(this)}),t={},n.each(i,function(i,r){var u=t[r.name];typeof u!="undefined"&&u!=null?n.isArray(u)?r.value&&u.push(r.value):t[r.name]=u&&r.value?[u,r.value]:u?[u]:r.value?[r.value]:null:t[r.name]=r.value}),t}})(jQuery),function(n){function r(t){var u=t.id,s=n(t).parent(),f=n.data(t,"uploadbox"),e=n.extend({browse_button:"btn_"+u},f.options),o=AX.format('<div id="btn_{0}" class="weui-uploader__input-box"><\/div>',u),r;n(o).insertAfter(t);r=new plupload.Uploader(e);f.options._uploader=r;r._opts=e;r._box=n(t);r._container=n(t).parent();r._files=n(t).closest(".weui-uploader").find(".weui-uploader__files");r._gallery=n(t).closest(".weui-cells").find(".weui-gallery");r._numbox=n(t).closest(".weui-uploader").find(".num");r._files.on("click","li",function(){r._index=n(this).index();r._gallery.find(".weui-gallery__img").attr("style",this.getAttribute("style"));r._gallery.fadeIn(100)});r._files.on("click",".close",function(t){t.stopPropagation();r._index=n(this).parent().index();var u=r._files.find("li").eq(r._index).attr("id");i(r,r.getFile(u))});r._gallery.on("click",function(){r._gallery.fadeOut(100)});r._gallery.find(".weui-gallery__del").click(function(){var n=r._files.find("li").eq(r._index).attr("id");i(r,r.getFile(n))});r.init()}function u(n){var t=AX.tick();return(!n.params||n.params.expire<t+3)&&AX.ajax({url:AX.api({api:"aliyun/getosssign"}),data:{bucket:n._opts.bucket,dir:n._opts.dir},type:"get","async":!1,cb:function(t){n.params=t.value}}),n.params}function e(t,i){var r=new moxie.file.FileReader;r.onload=function(){var u=AX.format('<li id="{0}" class="weui-uploader__file weui-uploader__file_status" style="background-image:url({1})">                <div class="close">X<\/div>                <div class="weui-uploader__file-content">0%<\/div>            <\/li>',i.id,r.result);t._files.append(n(u));r.destroy();f=null};r.readAsDataURL(i.getSource())}function i(n,i){i&&(i.url?n._opts.bucket?AX.ajax({url:AX.api({api:"aliyun/delossfile"}),data:{bucket:n._opts.bucket,key:i.ossName},type:"delete",cb:function(){n._box.val(n._box.val().replace(","+i.url,""));t(n,i)}}):n._opts.dir&&AX.ajax({url:AX.api({api:"file/delfile"}),data:{file:i.url},type:"delete",cb:function(){n._box.val(n._box.val().replace(","+i.url,""));t(n,i)}}):t(n,i))}function t(n,t){n.removeFile(t);n._files.find("li").eq(n._index).remove()}n.fn.uploadbox=function(t,i){return typeof t=="string"?n.fn.uploadbox.methods[t](this,i):(t=t||{},this.each(function(){var i=n.data(this,"uploadbox");i?n.extend(i.options,t):i=n.data(this,"uploadbox",{options:n.extend({},n.fn.uploadbox.defaults,t)});r(this)}))};n.fn.uploadbox.methods={options:function(t){return n.data(t[0],"uploadbox").options},start:function(t){var i=n.data(t[0],"uploadbox").options;i._uploader.start()},count:function(t){var i=n.data(t[0],"uploadbox").options;return i._uploader.files.length},fadeout:function(t){var i=n.data(t[0],"uploadbox").options;i._uploader._gallery.fadeOut(100)}};n.fn.uploadbox.defaults={url:"http://oss.aliyuncs.com",runtimes:"html5,flash,silverlight,html4",multi_selection:!0,flash_swf_url:"plupload/js/Moxie.swf",silverlight_xap_url:"plupload/js/Moxie.xap",multipart:!0,autoUpload:!0,max_retries:0,beforeUpload:function(){},uploaded:function(){},filters:{mime_types:[{title:"图片文件",extensions:"jpg,jpeg,gif,png,bmp"},{title:"办公文档",extensions:"doc,docx,xls,xlsx,ppt,pptx,pdf,txt"},{title:"压缩文件",extensions:"zip,rar"}],max_file_size:"20mb",prevent_duplicates:!0},init:{PostInit:function(){for(var i=this._box.val().split(","),t=1;t<i.length;t++){var n=i[t],u=AX.filename(n).substr(11),r=n;n.substr(0,4)=="http"&&(r=n.substr(n.indexOf("/",10)+1));createProgress(this,{id:t,name:u,ossName:r,url:n,size:0,percent:100})}},FilesAdded:function(n,t){var r=n.files.length-t.length,i=!1;plupload.each(t,function(t){r++<n._opts.max?e(n,t):(i=!0,n.removeFile(t))});i&&AX.wxWarn("最多能上传"+n._opts.max+"个文件！");n.files.length==n._opts.max&&n._container.hide();n._numbox.text(n.files.length);n._opts.autoUpload&&setTimeout(function(){n.start()},100)},FilesRemoved:function(n){n.files.length<n._opts.max&&n._container.show();n._numbox.text(n.files.length)},BeforeUpload:function(n,t){var i,r;n._opts.bucket?(i=u(n),t.ossName=i.dir+"/"+AX.tick()+"_"+t.name,t.url=i.host+"/"+t.ossName,r={key:t.ossName,policy:i.policy,OSSAccessKeyId:i.accessid,success_action_status:"200",callback:i.callback,signature:i.signature},n.setOption({url:i.host,multipart_params:r})):(n._opts.dir&&(t.fileName=n._opts.dir+"/"+AX.tick()+"_"+t.name,t.url="/upload/"+t.fileName),n._opts.beforeUpload&&n._opts.beforeUpload.call(n))},UploadProgress:function(t,i){n("#"+i.id).find(".weui-uploader__file-content").text(i.percent+"%")},FileUploaded:function(n,t,i){i.status==200?n._opts.dir&&n._box.val(n._box.val()+","+t.url):i.status==203},UploadComplete:function(n){n._opts.uploaded&&n._opts.uploaded.call()},Error:function(n,t){t.code==-600?AX.wxWarn("选择的文件太大了！"):t.code==-601?AX.wxWarn("选择的文件后缀不对！"):t.code==-602?AX.wxWarn("这个文件已经上传!"):AX.wxWarn("发生错误:"+t.response)}}}}(jQuery),function(n){var t={opts:{w:300,h:450,url:n.location.href,maxW:$(n.top).width(),maxH:$(n.top).height(),dialogMode:!0,_modified:!1,_curMods:[]},init:function(n){n=n||{};this.opts=$.extend(this.opts,n);t.root=n.root||"/"},modify:function(){t.opts._modified=!0},go:function(i){n.location=t.aurl(i,"t",t.tick())},goBack:function(){window.location="native://goback"},refresh:function(){n.location=t.aurl(n.location.href,"t",t.tick())},query:function(t,i){var s,e,r,u,o,f;if(typeof i=="undefined"&&(i=n.location.search),typeof t!="undefined")return(s=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),e=i.substr(1).match(s),e!=null)?unescape(e[2]):null;for(r=[],o=i.substr(1).split("&"),f=0;f<o.length;f++)u=o[f].split("="),r.push(u[0]),r[u[0]]=u[1];return r},aurl:function(n,t,i){var r=n.indexOf(t+"="),u;return r>0?(u=n.indexOf("&",r),u>r?n.replace(n.substr(r,u-r),t+"="+i):n.substr(0,r)+t+"="+i):n.indexOf("?")>0?n+"&"+t+"="+i:n+"?"+t+"="+i},api:function(n){var i=t.format("{0}api/{1}",t.opts.root,n.api);return n.ds&&(i=t.aurl(i,"app",t.opts.app),i=t.aurl(i,"ds",n.ds)),n.q&&(i+=i.indexOf("?")>0?"&":"?",i+=n.q),i},ajaxerror:function(n){try{var i=n.responseJSON.error_description||n.responseJSON.error;t.wxFail(i)}catch(r){t.wxWarn(n.status+"："+n.statusText)}},ajax:function(n){n.success=n.success||function(t){n.cb&&n.cb(t)};(n.type=="post"||n.type=="put")&&(n.data=JSON.stringify(n.data),n.dataType=n.dataType||"json",n.contentType=n.contentType||"application/json");n.error=n.error||t.ajaxerror;$.ajax(n)},len:function(n){for(var t=0,i=0;i<n.length;i++,t++)n[i].match(/[^x00-xff]/ig)!=null&&t++;return t},now:function(){return new Date},tick:function(){return Date.parse(new Date)/1e3},pad:function(n,t,r,u){if(n.length<r){var f="";for(i=1;i<=r-n.length;i++)f+=t;return u?f+n:n+f}return n},format:function(){var n=arguments;return n.length<1?null:n[0].replace(/\{(\d+)(:(0{2,}))?\}/g,function(t,i){var f=t.indexOf(":"),r=$.isArray(n[1])?n[1][i].toString():n[++i].toString(),u;return f<0?r:(u=t.substring(f+1,t.length-1),u.length<r.length)?r:u.substr(0,u.length-r.length)+r})},aurl:function(n,t,i){var r=n.indexOf(t+"="),u;return r>0?(u=n.indexOf("&",r),u>r?n.replace(n.substr(r,u-r),t+"="+i):n.substr(0,r)+t+"="+i):n.indexOf("?")>0?n+"&"+t+"="+i:n+"?"+t+"="+i},objstr:function(n,t){return t?n.replace(/\{([^\d\{\}]+)([\w\_]+)?\}/g,function(n,i){return t[i]}):n},rndstr:function(n){var t;n=n||32;var i="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",u=i.length,r="";for(t=0;t<n;t++)r+=i.charAt(Math.floor(Math.random()*u));return r},isdate:function(n){var i=t.dateobj(n);return!isNaN(i)||!isNaN(d2)},date:function(n){return t.datestr(t.now,n)},dateobj:function(n){var t=n.match(/\d+/g);return new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0,t[5]||0)},datestr:function(n,i){return typeof n=="string"&&(n=t.dateobj(n)),i.replace(/"[^"]*"|'[^']*'|\b(?:d{1,4}|M{1,4}|yy(?:yy)?|([hHmstT])\1?|[lLZ])\b/g,function(i){switch(i){case"d":return n.getDate();case"dd":return t.format("{0:00}",n.getDate());case"ddd":return $.fn.calendar.defaults.weeks[n.getDay()];case"dddd":return"星期"+$.fn.calendar.defaults.weeks[n.getDay()];case"M":return n.getMonth()+1;case"MM":return t.format("{0:00}",n.getMonth()+1);case"MMM":return $.fn.calendar.defaults.months[n.getMonth()].replace("月","");case"MMMM":return $.fn.calendar.defaults.months[n.getMonth()];case"yy":return String(n.getFullYear()).substr(2);case"yyyy":return n.getFullYear();case"h":return n.getHours()%12||12;case"hh":return t.format("{0:00}",n.getHours()%12||12);case"H":return n.getHours();case"HH":return t.format("{0:00}",n.getHours());case"m":return n.getMinutes();case"mm":return t.format("{0:00}",n.getMinutes());case"s":return n.getSeconds();case"ss":return t.format("{0:00}",n.getSeconds());case"l":return t.format("{0:000}",n.getMilliseconds(),3);case"L":var r=n.getMilliseconds();return r>99&&(r=Math.round(r/10)),t.format("{0:00}",r);case"tt":return n.getHours()<12?"am":"pm";case"TT":return n.getHours()<12?"AM":"PM";case"Z":return n.toUTCString().match(/[A-Z]+$/);default:return i.substr(1,i.length-2)}})},wxRun:function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("micromessenger")!=-1},wxUrl:function(){var i=t.aurl(n.location.href,"t",t.tick());n.history.replaceState(null,null,i)},wxInit:function(i){if(wx.config({beta:!0,debug:!1,appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonce,signature:i.signature,jsApiList:i.jsApi}),i.resetUrl){var r=t.aurl(n.location.href,"t",i.timestamp);history.replaceState(null,null,r)}},wxOk:function(n){$.toptip(n||"操作成功",2e3,"success")},wxFail:function(n){$.toptip(n||"操作失败",2e3,"error")},wxWarn:function(n){$.toptip(n,2e3,"warning")},wxScan:function(n){wx.scanQRCode({needResult:1,scanType:["qrCode"],success:function(t){n(t.resultStr)}})},wxWiFi:function(n){wx.invoke("configWXDeviceWiFi",{},function(i){i.err_msg=="configWXDeviceWiFi:ok"?n():i.err_msg=="configWXDeviceWiFi:cancel"?t.wxWarn("配网已取消！"):t.wxFail("配网失败，请确认已按配网要求进行操作！")})},wxMap:function(n,t,i,r,u){wx.openLocation({latitude:n,longitude:t,name:i,address:r,scale:14,infoUrl:u||null})},wxLoc:function(n,i){wx.getLocation({type:"wgs84",success:function(t){n(t.longitude,t.latitude)},cancel:i||function(){t.wxWarn("获取定位失败，用户拒绝授权！")}})},wxPage:function(){var r=!1,u=!0,i=$(".page"),h=$(".page .bd"),o='<i class="weui-loading"><\/i><span class="weui-loadmore__tips">正在加载<\/span>',s='<span class="weui-loadmore__tips">已无更多数据啦<\/span>',t=new Function("return {"+$("pager").attr("data-options")+"}")(),f=function(){i.infinite().find(".weui-loadmore").html(o)},e=function(){i.destroyInfinite().find(".weui-loadmore").html(s)};t.pageNumber==t.pageCount?e():f();i.pullToRefresh().on("pull-to-refresh",function(){$.get(n.location.href,function(n){$(".weui-photo-browser-modal").remove();$(".weui-cells").replaceWith($(n).find(".weui-cells"));i.pullToRefreshDone();u||f()})});i.on("infinite",function(){if(!r&&(r=!0,t=new Function("return {"+$("pager").attr("data-options")+"}")(),t.pageNumber<t.pageCount)){var i=AX.aurl(n.location.href,"page",t.pageNumber+1);$.get(i,function(n){$("pager").replaceWith($(n).find(".weui-cells").children());t.pageNumber+1==t.pageCount&&(u=!1,e());r=!1})}})},wxPhoto:function(n){var t=$(event.srcElement).closest(".weui-cell"),i;t.length||(t=$(event.srcElement).parent());i=t.data("photoBrowser");i||(i=$.photoBrowser({items:t.attr("data-photos").split(",")}),t.data("photoBrowser",i));i.open(n)},setUser:function(n,i){t.ajax({url:t.api({api:"auth/putuser"}),data:n,type:"put",cb:function(){t.wxOk("修改成功！");i()}})},setUid:function(n,i){n==""&&$.prompt({title:"设置登录名",text:"登录名由数字和字母组成，20个字符以内，设置成功后不能再次修改！",input:"登录名",empty:!1,onOK:function(n){n.length<20?t.setUser({loginname:n},function(){i(n)}):t.wxWarn("登录名不能超过20个字符！")}})},setNik:function(n,i){$.prompt({title:"设置昵称",text:"昵称不能超过10个字符，可以再改！",input:n,empty:!1,onOK:function(n){n.length<20?t.setUser({nickname:n},function(){i(n)}):t.wxWarn("昵称不能超过20个字符！")}})}};n.AX=t}(window);