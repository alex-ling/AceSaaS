@page
@inherits Acesoft.Web.UI.RazorPages.WebPage
@{
    ViewData["Title"] = "设备在线";
    Layout = "_shared/body";

    var url = App.GetWebPath("/home/down?clientid=983633255355908096&sbno=", true);
    url = System.Web.HttpUtility.UrlEncode(url);

    Ace.Layout().Fit().Items(layout =>
    {
        layout.Add().Border().Region(Region.north).Height(44).Controls(ctls =>
        {
            Ace.Search().Id("search").AppendTo(ctls).For("grid").Controls(query =>
            {
                Ace.TextBox().Name("keyword").AppendTo(query).Label("关键字：");
                Ace.ComboTree().Name("product").AppendTo(query).Label("　产品：").Ajax(ds => ds.DataSource("iot.product_tree").HttpGet()).Width(220).PanelWidth(300);
                Ace.ComboBox().Name("online").AppendTo(query).Label("　状态：").Width(120).Items(items =>
                {
                    items.Add(new ComboItem("", "　"));
                    items.Add(new ComboItem("1", "在线"));
                    items.Add(new ComboItem("0", "离线"));
                });
            })
            .Tools(tools =>
            {
                Ace.Button().AppendTo(tools).Text("导出清单").IconCls("fa fa-arrow-right").Click("AX.gridEx('#grid')");
            });
        });
        layout.Add().Border(false).Region(Region.center).Controls(ctls =>
        {
            Ace.DataGrid().Id("grid").AppendTo(ctls).Pagination().Export()
            .DataSource("iot.onlinereg").Ajax(ds => ds.Controller("iot").HttpGet()).Columns(c =>
            {
                c.Add().Field("sbno").Title("设备编号").Width(6).Format("tip:onShow");
                c.Add().Field("mac").Title("MAC地址").Width(6);
                c.Add().Field("name").Title("设备名称").Width(6);
                //c.Add().Field("cpxh").Title("设备型号").Width(5);
                //c.Add().Field("ztsj").Title("最后状态时间").Format("date:yy-MM-dd HH:mm");
                c.Add().Field("alias").Title("设备别名").Width(5);
                c.Add().Field("sfdq").Title("地区").Width(6);
                c.Add().Field("loc").Title("安装地址").Width(16);
                c.Add().Field("zcsj").Title("注册时间").Width(8).Format("date:yy-MM-dd HH:mm:ss");
                c.Add().Field("online").Title("在线").Format("bool");
                c.Add().Field("action").Title("操作").Format("button");
            });
        });
    }).Render();
}
<script>
    var cpnos = {
        HOD1: 'hod1',
        HOD2: 'hod1',
        HOD3: 'hod1',
        HOD4: 'hod4',
        HOD5: 'hod4'
    };
    function event_grid_opt(cid, id) {
        var row = $('#grid').datagrid('getRow', id);
        var cpno = row.sbno.substr(0, 4);
        AX.dialog('在线控制', '/webapp/iot/device/d_' + cpnos[cpno] + '?sbno=' + row.sbno, null, 450, 640);
    }
    function event_grid_test(cid, id) {
        var row = $('#grid').datagrid('getRow', id);
        var cpno = row.sbno.substr(0, 4);
        AX.dialog('全面测试', 't_' + cpnos[cpno] + '?sbno=' + row.sbno, null, 600, 500);
    }
    function onShow(jq) {
        jq.html('<img style="width:250px" src="/api/draw/getqrcode?text=@(url)' + $(this).text() + '" />');
    }
</script>